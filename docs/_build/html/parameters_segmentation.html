

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Segmentation &mdash; EllipTrack  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/hacks.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Track Linking" href="parameters_track_linking.html" />
    <link rel="prev" title="Global Setting" href="parameters_global_setting.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EllipTrack
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="parameters.html">Parameters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parameters_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters_global_setting.html">Global Setting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Segmentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-specific-parameters">Non-Specific Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-binarization">Image Binarization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#active-contour">Active Contour</a></li>
<li class="toctree-l3"><a class="reference internal" href="#watershed">Watershed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ellipse-fitting">Ellipse Fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#correction-with-training-datasets">Correction with Training Datasets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters_track_linking.html">Track Linking</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters_signal_extraction.html">Signal Extraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GUI.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution.html">Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EllipTrack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="parameters.html">Parameters</a> &raquo;</li>
        
      <li>Segmentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/parameters_segmentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="segmentation">
<span id="parameters-segmentation-page"></span><h1>Segmentation<a class="headerlink" href="#segmentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Segmentation consists of multiple steps.
As illustrated in <a class="reference internal" href="#para-segmentation"><span class="std std-numref">Fig. 1</span></a>, images of the nuclear marker are first binarized in Image Binarization.
The resulting binary images, called “mask”, are then optimized by Active Contour and Watershed.
Nuclear contours in the mask are then fitted by ellipses in Ellipse Fitting.
Finally, segmentation mistakes are corrected in Correction with Training Datasets and features are extracted from each ellipse in Feature Extraction.</p>
<p>Within the pipeline, Image Binarization, Ellipse Fitting, and Feature Extraction (blue) are required, while other steps (green) are optional.</p>
<div class="figure align-center" id="id1">
<span id="para-segmentation"></span><a class="reference internal image-reference" href="_images/para_segmentation.png"><img alt="_images/para_segmentation.png" src="_images/para_segmentation.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Schematic diagram of Segmentation.</span></p>
</div>
<p>For clarity, <em>segmentation_para</em> is divided into multiple lower-level Matlab structures, where each structure contains the parameters for one Segmentation step.
Five lower-level structures are available:</p>
<ul class="simple">
<li><em>image_binarization_para</em>. Parameters for Image Binarization.</li>
<li><em>active_contour_para</em>. Parameters for Active Contour.</li>
<li><em>watershed_para</em>. Parameters for Watershed.</li>
<li><em>ellipse_para</em>. Parameters for Ellipse Fitting.</li>
<li><em>seg_correction_para</em>. Parameters for Correction with Training Datasets.</li>
</ul>
<p>In addition, <em>segmentation_para</em> contains parameters not specific to any steps (“non-specific parameters”).</p>
</div>
<div class="section" id="non-specific-parameters">
<span id="parameters-segmentation-nonspecific"></span><h2>Non-Specific Parameters<a class="headerlink" href="#non-specific-parameters" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><span class="greenitalic">if_active_contour</span>. Indicator variable of whether to run Active Contour.</p>
</li>
<li><p class="first"><span class="greenitalic">if_watershed</span>. Indicator variable of whether to run Watershed.</p>
</li>
<li><p class="first"><span class="greenitalic">if_seg_correction</span>. Indicator variable of whether to run Correction with Training Datasets.</p>
<p>Parameters specific to nonexecuted steps do not affect the tracking performance.</p>
</li>
<li><p class="first"><span class="reditalic">if_print_mask</span>. Indicator variable of whether to generate the mask before Ellipse Fitting.</p>
</li>
<li><p class="first"><span class="reditalic">mask_path</span>. Path to the folder storing the masks.</p>
</li>
<li><p class="first"><span class="reditalic">if_print_ellipse_movie</span>. Indicator variable of whether to generate “Ellipse Movie” where fitted ellipses are overlaid on the nuclear images (similar to Figure 1F).</p>
</li>
<li><p class="first"><span class="reditalic">ellipse_movie_path</span>. Path to the folder storing the “Ellipse Movies”.</p>
</li>
<li><p class="first"><span class="reditalic">if_save_seg_info</span>. Indicator variable of whether to save the features of ellipses in each frame (“seg info”).</p>
</li>
<li><p class="first"><span class="reditalic">seg_info_path</span>. Path to the folder storing the “seg info”.</p>
<p>“Seg Info” files are required for Training Data Generator GUI.</p>
</li>
<li><p class="first"><span class="greenitalic">nuc_radius</span>. Average radius (in pixels) of a nucleus.</p>
</li>
<li><p class="first"><span class="greenitalic">max_hole_size_for_fill</span>. Maximal area (in pixels) of a hole to fill in.</p>
</li>
<li><p class="first"><span class="greenitalic">min_component_size_for_nucleus</span>. Minimal area (in pixels) of a component to contain a nucleus.</p>
<p>A component is defined as a set of connected foreground pixels (value = 1) in the mask, and a hole is defined as a set of connected background pixels (value = 0) within a component.
Holes smaller than or equal to <span class="greenitalic">max_hole_size_for_fill</span> and components smaller than <span class="greenitalic">min_component_size_for_nucleus</span> will be removed.</p>
</li>
</ul>
</div>
<div class="section" id="image-binarization">
<span id="parameters-segmentation-image-binarization"></span><h2>Image Binarization<a class="headerlink" href="#image-binarization" title="Permalink to this headline">¶</a></h2>
<p>EllipTrack provides two methods of Image Binarization and Blob Detection (controlled by <span class="reditalic">if_blob_detection</span>).</p>
<dl class="docutils">
<dt>Thresholding</dt>
<dd>Images of the nuclear marker (“raw images”) are first smoothed by the Matlab function <em>imfilter</em> with a disk of radius <span class="greenitalic">blurradius</span>.
After an optional log-transform (controlled by <span class="reditalic">if_log</span>), images are then auto-scaled with the Matlab function <em>mat2gray</em> and binarized by the Matlab function <em>imbinarize</em>.
Finally, small components and small holes are removed from the mask.</dd>
<dt>Blob Detection</dt>
<dd>Raw images are log-transformed (optional step, controlled by <span class="reditalic">if_log</span>) and sharpened.
The spatial second-order derivative of the images (Hessian) are then computed and a global threshold <span class="blueitalic">blob_threshold</span> is applied to the Hessian to binarize the images.
Finally, small components and small holes are removed from the mask.</dd>
</dl>
<ul>
<li><p class="first"><span class="greenitalic">blurradius</span>. Both methods. Radius (in pixels) of disk for smoothing.</p>
</li>
<li><p class="first"><span class="reditalic">if_log</span>. Both methods. Indicator variable of whether to log-transform the images.</p>
<p>Not to be confused with the namesake in <a class="reference internal" href="#parameters-segmentation-active-contour"><span class="std std-ref">Active Contour</span></a>.</p>
</li>
<li><p class="first"><span class="reditalic">if_blob_detection</span>. Both methods. Indicator variable of whether to run Blob Detection.</p>
</li>
<li><p class="first"><span class="blueitalic">blob_threshold</span>. Blob Detection only. Threshold of Hessian.</p>
</li>
</ul>
</div>
<div class="section" id="active-contour">
<span id="parameters-segmentation-active-contour"></span><h2>Active Contour<a class="headerlink" href="#active-contour" title="Permalink to this headline">¶</a></h2>
<p>Active Contour (a.k.a. “Snake”) is an image processing algorithm to identify object outlines from a noisy background.
The algorithm takes two inputs - a raw image and its mask - and outputs an optimized mask by modifying the shape of components with the pixel intensities in the raw image.</p>
<p>In EllipTrack, raw images are log-transformed (optional step, controlled by <span class="reditalic">if_log</span>) and auto-scaled.
Raw images and their masks are then processed by the Active Contour algorithm to generate the optimized masks.
EllipTrack provides two methods of Active Contour: Global and Local (controlled by <span class="reditalic">if_global</span>)</p>
<dl class="docutils">
<dt>Global</dt>
<dd>Active Contour is applied to the entire image.</dd>
<dt>Local</dt>
<dd>Actice Contour is applied to the local neighborhood of every component. Optimized masks from local neighborhoods are then assembled.</dd>
</dl>
<p>Finally, EllipTrack smoothes the mask with the Matlab function <em>imfilter</em> with a disk of radius <span class="greenitalic">blurradius</span> and removes small component and small holes from the mask.</p>
<ul>
<li><p class="first"><span class="greenitalic">blurradius</span>. Radius (in pixels) of disk for smoothing.</p>
</li>
<li><p class="first"><span class="reditalic">if_log</span>. Indicator variable of whether to log-transform the images.</p>
<p>Not to be confused with the namesake in <a class="reference internal" href="#parameters-segmentation-image-binarization"><span class="std std-ref">Image Binarization</span></a>.</p>
</li>
<li><p class="first"><span class="reditalic">if_global</span>. Indicator variable of whether to run the Global method.</p>
</li>
</ul>
</div>
<div class="section" id="watershed">
<h2>Watershed<a class="headerlink" href="#watershed" title="Permalink to this headline">¶</a></h2>
<p>Watershed is an image processing algorithm to separate overlapping objects.
In brief, the algorithm mimics a component by a watershed and defines the elevations of pixels by their distances to the image background.
Pixels with local maximal elevations (peaks) are treated as markers, and basins best separating the markers (path of water flow) are used to cut the component.</p>
<p>In EllipTrack, a peak is not defined by a single pixel.
Instead, it is defined by a set of pixels with area between <span class="greenitalic">min_thresh_component_size</span> and <span class="greenitalic">max_thresh_component_size</span> obtained by repeatedly eroding the mask.</p>
<ul class="simple">
<li><span class="greenitalic">max_thresh_component_size</span>. Maximal area (in pixels) of a peak.</li>
<li><span class="greenitalic">min_thresh_component_size</span>. Minimal area (in pixels) of a peak.</li>
</ul>
</div>
<div class="section" id="ellipse-fitting">
<h2>Ellipse Fitting<a class="headerlink" href="#ellipse-fitting" title="Permalink to this headline">¶</a></h2>
<p>EllipTrack uses a previously published algorithm (Zafari <em>et al.</em> 2015) to fit the contours of components by ellipses.
Irregular ellipses, including ellipses with perimeters smaller than <span class="greenitalic">min_ellipse_perimeter</span>, area smaller than <span class="greenitalic">min_ellipse_area</span>, and major axis greater than <span class="greenitalic">max_major_axis</span>, are removed.</p>
<ul class="simple">
<li><span class="greenitalic">k</span>, <span class="greenitalic">thd1</span>, <span class="greenitalic">thd2</span>, <span class="greenitalic">thdn</span>, <span class="greenitalic">C</span>, <span class="greenitalic">T_angle</span>, <span class="greenitalic">sig</span>, <span class="greenitalic">Endpoint</span>, <span class="greenitalic">Gap_size</span>. Parameters in Zafari <em>et al.</em> 2015. Refer to the original publication for more information.</li>
<li><span class="greenitalic">min_ellipse_perimeter</span>. Minimal perimeter (in pixels) of an ellipse.</li>
<li><span class="greenitalic">min_ellipse_area</span>. Minimal area (in pixels) of an ellipse.</li>
<li><span class="greenitalic">max_major_axis</span>. Maximal major axis (in pixels) of an ellipse.</li>
</ul>
</div>
<div class="section" id="correction-with-training-datasets">
<span id="parameters-segmentation-correction"></span><h2>Correction with Training Datasets<a class="headerlink" href="#correction-with-training-datasets" title="Permalink to this headline">¶</a></h2>
<p>EllipTrack trains a linear discriminant classifier with user-provided training datasets (specified by <span class="reditalic">training_data_path</span>) to predict the number of nuclei in each ellipse.
Ellipses with a high probability of containing no nucleus (greater than <span class="greenitalic">min_no_cell_prob</span>) are removed.
Ellipses with a high probability of containing two nuclei (greater than <span class="greenitalic">min_two_cells_prob</span>) are split into two with the k-means algorithm.
Since k-means is a stochastic algorithm, to maintain a high confidence of splitting, EllipTrack runs the k-means algorithm twice and only splits the ellipses if the fraction of mismatch between these two runs is less than <span class="greenitalic">max_fraction_mismatch</span>.
In addition, ellipses with an area smaller than <span class="greenitalic">min_ellipse_area_twocells</span> will not be split.</p>
<ul>
<li><p class="first"><span class="reditalic">training_data_path</span>. Paths to the training datasets.</p>
<p>To load <em>n</em> training datasets, <span class="reditalic">training_data_path</span> should be an <em>n x 1</em> cell array where each row is a string specifying the path to one training dataset.</p>
<div class="hint admonition">
<p class="first admonition-title">Examples</p>
<p>Two training datasets are available.
The first one is located in <code class="docutils literal notranslate"><span class="pre">X:/tracking/mat_files/training_data1.mat</span></code> and the second one is located in <code class="docutils literal notranslate"><span class="pre">X:/tracking/mat_files/training_data2.mat</span></code>.
To load both datasets into EllipTrack, the value of the parameter should be</p>
<div class="last highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">training_data_path</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;X:/tracking/mat_files/training_data1.mat&#39;</span><span class="p">;</span>
                      <span class="s">&#39;X:/tracking/mat_files/training_data2.mat&#39;</span><span class="p">};</span>
</pre></div>
</div>
</div>
<p>Not to be confused with the namesake in <a class="reference internal" href="parameters_track_linking.html#parameters-track-linking-predict"><span class="std std-ref">Predict Probabilities</span></a> of <a class="reference internal" href="parameters_track_linking.html#parameters-track-linking-page"><span class="std std-ref">Track Linking</span></a>.</p>
</li>
<li><p class="first"><span class="greenitalic">min_ellipse_area_twocells</span>. Minimal area (in pixels) of an ellipse for splitting.</p>
</li>
<li><p class="first"><span class="greenitalic">max_fraction_mismatch</span>. Maximal fraction (between 0 and 1) of mismatch between two k-means runs.</p>
</li>
<li><p class="first"><span class="greenitalic">min_no_cell_prob</span>. Minimal probability (between 0 and 1) of containing no nucleus for removal.</p>
</li>
<li><p class="first"><span class="greenitalic">min_two_cells_prob</span>. Minimal probability (between 0 and 1) of containing two nuclei for splitting.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parameters_track_linking.html" class="btn btn-neutral float-right" title="Track Linking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parameters_global_setting.html" class="btn btn-neutral float-left" title="Global Setting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Chengzhe Tian, Chen Yang, Sabrina Spencer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>